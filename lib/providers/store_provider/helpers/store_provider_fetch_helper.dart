import 'dart:async';

import 'package:coop_test/providers/_providers.dart';
import 'package:coop_test/utils/_utils.dart';
import 'package:http/http.dart' as http;

typedef StoreFetchResult = ({
  List<Store>? stores,
  HttpError? error,
});

class StoreProviderFetchHelper {
  const StoreProviderFetchHelper({required Logger logger}) : _logger = logger;

  // region Dependencies

  final Logger _logger;

  // endregion

  // region Values

  static const Duration _fetchTimeout = Duration(seconds: 10);

  // endregion

  // region Exposed

  Future<StoreFetchResult> fetchForInput(String input) async {
    try {
      final result = await http.Client().get(_getUrlForInput(input)).timeout(_fetchTimeout);

      print(result.body);

      // flutter: {"Location":{"Bounds":null,"Longitude":10.7360365,"Latitude":59.9499228},"Stores":[{"StoreId":"4292","Name":"Ullevål","Chain":"Mega","ChainClassName":"mega","ChainId":"03","IsEcommerce":false,"NewspaperUrl":"http://kundeavis.coop.no/aviser/?id=4292","ChainImage":"/assets/images/mapmarkers/03.png?d7b089ef57ad29e69c3520f42bc8aae1","InStoreServices":["memberoffer"],"Lat":59.9499228,"Lng":10.7360365,"OpeningHoursToday":"Stengt","OpenNow":false,"Phone":"22581660","Address":"SOGNSVEIEN 77C, 0855 OSLO","City":"Oslo","Distance":0,"Email":"ulleval.mega@coop.no","SLag":"NORSK BUTIKKDRIFT AS","OrganizationNumber":"931186744","SpecialOpeningHours":[],"OpeningHours":[{"Date":"10/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false},{"Date":"11/03","OpenString":"07:00-22:00","Day":"Mandag","Closed":false,"SpecialOpeningHours":false},{"Date":"12/03","OpenString":"07:00-22:00","Day":"Tirsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"13/03","OpenString":"07:00-22:00","Day":"Onsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"14/03","OpenString":"07:00-22:00","Day":"Torsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"15/03","OpenString":"07:00-22:00","Day":"Fredag","Closed":false,"SpecialOpeningHours":false},{"Date":"16/03","OpenString":"07:00-20:00","Day":"Lørdag","Closed":false,"SpecialOpeningHours":false},{"Date":"17/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false}],"AdditionalInformation":{"Html":null}},{"StoreId":"4316","Name":"Vinderen","Chain":"Mega","ChainClassName":"mega","ChainId":"03","IsEcommerce":false,"NewspaperUrl":"http://kundeavis.coop.no/aviser/?id=4316","ChainImage":"/assets/images/mapmarkers/03.png?d7b089ef57ad29e69c3520f42bc8aae1","InStoreServices":["tipping","postnord"],"Lat":59.9432098,"Lng":10.7038199,"OpeningHoursToday":"Stengt","OpenNow":false,"Phone":"23222930","Address":"BORGENVEIEN 48, 0370 OSLO","City":"Oslo","Distance":0,"Email":"vinderen.mega@coop.no","SLag":"NORSK BUTIKKDRIFT AS","OrganizationNumber":"931186744","SpecialOpeningHours":[],"OpeningHours":[{"Date":"10/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false},{"Date":"11/03","OpenString":"08:00-22:00","Day":"Mandag","Closed":false,"SpecialOpeningHours":false},{"Date":"12/03","OpenString":"08:00-22:00","Day":"Tirsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"13/03","OpenString":"08:00-22:00","Day":"Onsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"14/03","OpenString":"08:00-22:00","Day":"Torsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"15/03","OpenString":"08:00-22:00","Day":"Fredag","Closed":false,"SpecialOpeningHours":false},{"Date":"16/03","OpenString":"08:00-20:00","Day":"Lørdag","Closed":false,"SpecialOpeningHours":false},{"Date":"17/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false}],"AdditionalInformation":{"Html":[{"tag":"p","children":["Instaboks og Posten pakkebokser"]}]}},{"StoreId":"4573","Name":"Majorstuen","Chain":"Extra","ChainClassName":"extra","ChainId":"07","IsEcommerce":false,"NewspaperUrl":"http://kundeavis.coop.no/aviser/?id=4573","ChainImage":"/assets/images/mapmarkers/07.png?938d3bb66e14f3c8dd9fc5b45feb4fce","InStoreServices":["memberoffer"],"Lat":59.9304949,"Lng":10.7161061,"OpeningHoursToday":"Stengt","OpenNow":false,"Phone":"22697320","Address":"HARALD HÅRFAGRESGT 2, 0363 OSLO","City":"Oslo","Distance":0,"Email":"majorstuen.extra@coop.no","SLag":null,"OrganizationNumber":"994496255","SpecialOpeningHours":[],"OpeningHours":[{"Date":"10/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false},{"Date":"11/03","OpenString":"07:00-23:00","Day":"Mandag","Closed":false,"SpecialOpeningHours":false},{"Date":"12/03","OpenString":"07:00-23:00","Day":"Tirsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"13/03","OpenString":"07:00-23:00","Day":"Onsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"14/03","OpenString":"07:00-23:00","Day":"Torsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"15/03","OpenString":"07:00-23:00","Day":"Fredag","Closed":false,"SpecialOpeningHours":false},{"Date":"16/03","OpenString":"07:00-23:00","Day":"Lørdag","Closed":false,"SpecialOpeningHours":false},{"Date":"17/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false}],"AdditionalInformation":{"Html":null}},{"StoreId":"4238","Name":"Tåsen","Chain":"Prix","ChainClassName":"prix","ChainId":"01","IsEcommerce":false,"NewspaperUrl":"http://kundeavis.coop.no/aviser/?id=4238","ChainImage":"/assets/images/mapmarkers/01.png?7003341bcfe337a104c5a8ee79251d4d","InStoreServices":["memberoffer","postnord"],"Lat":59.949938,"Lng":10.749888,"OpeningHoursToday":"Stengt","OpenNow":false,"Phone":"22237700","Address":"NILS LAURITSSØNSV. 57, 0870 OSLO","City":"Oslo","Distance":0,"Email":"tasen.prix@coop.no","SLag":"NORSK BUTIKKDRIFT AS","OrganizationNumber":"931186744","SpecialOpeningHours":[],"OpeningHours":[{"Date":"10/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false},{"Date":"11/03","OpenString":"07:00-23:00","Day":"Mandag","Closed":false,"SpecialOpeningHours":false},{"Date":"12/03","OpenString":"07:00-23:00","Day":"Tirsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"13/03","OpenString":"07:00-23:00","Day":"Onsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"14/03","OpenString":"07:00-23:00","Day":"Torsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"15/03","OpenString":"07:00-23:00","Day":"Fredag","Closed":false,"SpecialOpeningHours":false},{"Date":"16/03","OpenString":"08:00-21:00","Day":"Lørdag","Closed":false,"SpecialOpeningHours":false},{"Date":"17/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false}],"AdditionalInformation":{"Html":null}},{"StoreId":"4948","Name":"Theresesgate","Chain":"Extra","ChainClassName":"extra","ChainId":"07","IsEcommerce":false,"NewspaperUrl":"http://kundeavis.coop.no/aviser/?id=4948","ChainImage":"/assets/images/mapmarkers/07.png?938d3bb66e14f3c8dd9fc5b45feb4fce","InStoreServices":["memberoffer"],"Lat":59.928273,"Lng":10.732078,"OpeningHoursToday":"Stengt","OpenNow":false,"Phone":"22931300","Address":"THERESESGATE 29, 0354 OSLO","City":"Oslo","Distance":0,"Email":"theresesgate.extra@coop.no","SLag":null,"OrganizationNumber":"997130510","SpecialOpeningHours":[],"OpeningHours":[{"Date":"10/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false},{"Date":"11/03","OpenString":"07:00-23:00","Day":"Mandag","Closed":false,"SpecialOpeningHours":false},{"Date":"12/03","OpenString":"07:00-23:00","Day":"Tirsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"13/03","OpenString":"07:00-23:00","Day":"Onsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"14/03","OpenString":"07:00-23:00","Day":"Torsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"15/03","OpenString":"07:00-23:00","Day":"Fredag","Closed":false,"SpecialOpeningHours":false},{"Date":"16/03","OpenString":"07:00-23:00","Day":"Lørdag","Closed":false,"SpecialOpeningHours":false},{"Date":"17/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false}],"AdditionalInformation":{"Html":null}},{"StoreId":"4226","Name":"Sagene","Chain":"Extra","ChainClassName":"extra","ChainId":"07","IsEcommerce":false,"NewspaperUrl":"http://kundeavis.coop.no/aviser/?id=4226","ChainImage":"/assets/images/mapmarkers/07.png?938d3bb66e14f3c8dd9fc5b45feb4fce","InStoreServices":["memberoffer","post"],"Lat":59.9355442,"Lng":10.7525795,"OpeningHoursToday":"Stengt","OpenNow":false,"Phone":"22389370","Address":"THURMANNSGT 12B, 0461 OSLO","City":"Oslo","Distance":0,"Email":"sagene.extra@coop.no","SLag":null,"OrganizationNumber":"916510101","SpecialOpeningHours":[],"OpeningHours":[{"Date":"10/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false},{"Date":"11/03","OpenString":"07:00-23:00","Day":"Mandag","Closed":false,"SpecialOpeningHours":false},{"Date":"12/03","OpenString":"07:00-23:00","Day":"Tirsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"13/03","OpenString":"07:00-23:00","Day":"Onsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"14/03","OpenString":"07:00-23:00","Day":"Torsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"15/03","OpenString":"07:00-23:00","Day":"Fredag","Closed":false,"SpecialOpeningHours":false},{"Date":"16/03","OpenString":"08:00-23:00","Day":"Lørdag","Closed":false,"SpecialOpeningHours":false},{"Date":"17/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false}],"AdditionalInformation":{"Html":null}},{"StoreId":"4280","Name":"Bjølsen","Chain":"Extra","ChainClassName":"extra","ChainId":"07","IsEcommerce":false,"NewspaperUrl":"http://kundeavis.coop.no/aviser/?id=4280","ChainImage":"/assets/images/mapmarkers/07.png?938d3bb66e14f3c8dd9fc5b45feb4fce","InStoreServices":["memberoffer","postnord"],"Lat":59.9382763,"Lng":10.7571308,"OpeningHoursToday":"Stengt","OpenNow":false,"Phone":"94176699","Address":"HAMMERGT. 1, 0465 OSLO","City":"Oslo","Distance":0,"Email":"bjolsen.extra@coop.no","SLag":"NORSK BUTIKKDRIFT AS","OrganizationNumber":"931186744","SpecialOpeningHours":[],"OpeningHours":[{"Date":"10/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false},{"Date":"11/03","OpenString":"07:00-23:00","Day":"Mandag","Closed":false,"SpecialOpeningHours":false},{"Date":"12/03","OpenString":"07:00-23:00","Day":"Tirsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"13/03","OpenString":"07:00-23:00","Day":"Onsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"14/03","OpenString":"07:00-23:00","Day":"Torsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"15/03","OpenString":"07:00-23:00","Day":"Fredag","Closed":false,"SpecialOpeningHours":false},{"Date":"16/03","OpenString":"07:00-23:00","Day":"Lørdag","Closed":false,"SpecialOpeningHours":false},{"Date":"17/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false}],"AdditionalInformation":{"Html":null}},{"StoreId":"4388","Name":"Bogstadveien","Chain":"Extra","ChainClassName":"extra","ChainId":"07","IsEcommerce":false,"NewspaperUrl":"http://kundeavis.coop.no/aviser/?id=4388","ChainImage":"/assets/images/mapmarkers/07.png?938d3bb66e14f3c8dd9fc5b45feb4fce","InStoreServices":["memberoffer"],"Lat":59.9269122,"Lng":10.7197239,"OpeningHoursToday":"Stengt","OpenNow":false,"Phone":"23202595","Address":"BOGSTADVEIEN 40-42, 0366 OSLO","City":"Oslo","Distance":0,"Email":"bogstadveien.extra@coop.no","SLag":"NORSK BUTIKKDRIFT AS","OrganizationNumber":"931186744","SpecialOpeningHours":[],"OpeningHours":[{"Date":"10/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false},{"Date":"11/03","OpenString":"07:00-23:59","Day":"Mandag","Closed":false,"SpecialOpeningHours":false},{"Date":"12/03","OpenString":"00:00-23:59","Day":"Tirsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"13/03","OpenString":"00:00-23:59","Day":"Onsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"14/03","OpenString":"00:00-23:59","Day":"Torsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"15/03","OpenString":"00:00-23:59","Day":"Fredag","Closed":false,"SpecialOpeningHours":false},{"Date":"16/03","OpenString":"00:00-23:00","Day":"Lørdag","Closed":false,"SpecialOpeningHours":false},{"Date":"17/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false}],"AdditionalInformation":{"Html":null}},{"StoreId":"4694","Name":"Bislett","Chain":"Extra","ChainClassName":"extra","ChainId":"07","IsEcommerce":false,"NewspaperUrl":"http://kundeavis.coop.no/aviser/?id=4694","ChainImage":"/assets/images/mapmarkers/07.png?938d3bb66e14f3c8dd9fc5b45feb4fce","InStoreServices":["memberoffer","tipping"],"Lat":59.9256543,"Lng":10.7303378,"OpeningHoursToday":"Stengt","OpenNow":false,"Phone":"22609585","Address":"PILESTREDET 73, 0354 OSLO","City":"Oslo","Distance":0,"Email":"bislett.extra@coop.no","SLag":null,"OrganizationNumber":"996179664","SpecialOpeningHours":[],"OpeningHours":[{"Date":"10/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false},{"Date":"11/03","OpenString":"07:00-23:00","Day":"Mandag","Closed":false,"SpecialOpeningHours":false},{"Date":"12/03","OpenString":"07:00-23:00","Day":"Tirsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"13/03","OpenString":"07:00-23:00","Day":"Onsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"14/03","OpenString":"07:00-23:00","Day":"Torsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"15/03","OpenString":"07:00-23:00","Day":"Fredag","Closed":false,"SpecialOpeningHours":false},{"Date":"16/03","OpenString":"07:00-23:00","Day":"Lørdag","Closed":false,"SpecialOpeningHours":false},{"Date":"17/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false}],"AdditionalInformation":{"Html":null}},{"StoreId":"4239","Name":"Neuberggt.","Chain":"Extra","ChainClassName":"extra","ChainId":"07","IsEcommerce":false,"NewspaperUrl":"http://kundeavis.coop.no/aviser/?id=4239","ChainImage":"/assets/images/mapmarkers/07.png?938d3bb66e14f3c8dd9fc5b45feb4fce","InStoreServices":["memberoffer","postnord"],"Lat":59.9263214,"Lng":10.715318,"OpeningHoursToday":"Stengt","OpenNow":false,"Phone":"22446398","Address":"NEUBERGGT. 19, 0367 OSLO","City":"Oslo","Distance":0,"Email":"neuberggt.extra@coop.no","SLag":"NORSK BUTIKKDRIFT AS","OrganizationNumber":"931186744","SpecialOpeningHours":[],"OpeningHours":[{"Date":"10/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false},{"Date":"11/03","OpenString":"07:00-23:00","Day":"Mandag","Closed":false,"SpecialOpeningHours":false},{"Date":"12/03","OpenString":"07:00-23:00","Day":"Tirsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"13/03","OpenString":"07:00-23:00","Day":"Onsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"14/03","OpenString":"07:00-23:00","Day":"Torsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"15/03","OpenString":"07:00-23:00","Day":"Fredag","Closed":false,"SpecialOpeningHours":false},{"Date":"16/03","OpenString":"07:00-23:00","Day":"Lørdag","Closed":false,"SpecialOpeningHours":false},{"Date":"17/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false}],"AdditionalInformation":{"Html":null}}],"AdditionalStores":[{"StoreId":"2541","Name":"Alnabru","Chain":"Obs","ChainClassName":"hyper","ChainId":"02","IsEcommerce":true,"NewspaperUrl":"http://kundeavis.coop.no/aviser/?id=2541","ChainImage":"/assets/images/mapmarkers/02.png?eaf870c29effdcc6b4556bf232dc9525","InStoreServices":["memberoffer","electric"],"Lat":59.9231386,"Lng":10.8446883,"OpeningHoursToday":"Stengt","OpenNow":false,"Phone":"22309400","Address":"SMALVOLLVEIEN 65, 0667 OSLO","City":"Oslo","Distance":0,"Email":"alnabru.obs.info@coop.no","SLag":"COOP ØST SA","OrganizationNumber":"948432617","SpecialOpeningHours":[],"OpeningHours":[{"Date":"10/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false},{"Date":"11/03","OpenString":"07:00-23:00","Day":"Mandag","Closed":false,"SpecialOpeningHours":false},{"Date":"12/03","OpenString":"07:00-23:00","Day":"Tirsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"13/03","OpenString":"07:00-23:00","Day":"Onsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"14/03","OpenString":"07:00-23:00","Day":"Torsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"15/03","OpenString":"07:00-23:00","Day":"Fredag","Closed":false,"SpecialOpeningHours":false},{"Date":"16/03","OpenString":"08:00-21:00","Day":"Lørdag","Closed":false,"SpecialOpeningHours":false},{"Date":"17/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false}],"AdditionalInformation":{"Html":[{"tag":"p","children":["Benytt hele butikkens åpningstid og munnbind, og du ikke kan holde 1meter avstand"]}]}},{"StoreId":"3507","Name":"Alnabru","Chain":"Obs BYGG","ChainClassName":"bygg","ChainId":"43","IsEcommerce":true,"NewspaperUrl":"http://kundeavis.coop.no/aviser/?id=3507","ChainImage":"/assets/images/mapmarkers/43.png?6a21519b1fc209e7ec9de07da05adb3a","InStoreServices":["memberoffer"],"Lat":59.9236,"Lng":10.8453,"OpeningHoursToday":"Stengt","OpenNow":false,"Phone":"22309444","Address":"SMALVOLLVEIEN 65 PORT A, 0667 OSLO","City":"Oslo","Distance":0,"Email":"alnabru.obsbygg@coop.no","SLag":"COOP ØST SA","OrganizationNumber":"948432617","SpecialOpeningHours":[],"OpeningHours":[{"Date":"10/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false},{"Date":"11/03","OpenString":"07:00-23:00","Day":"Mandag","Closed":false,"SpecialOpeningHours":false},{"Date":"12/03","OpenString":"07:00-23:00","Day":"Tirsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"13/03","OpenString":"07:00-23:00","Day":"Onsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"14/03","OpenString":"07:00-23:00","Day":"Torsdag","Closed":false,"SpecialOpeningHours":false},{"Date":"15/03","OpenString":"07:00-23:00","Day":"Fredag","Closed":false,"SpecialOpeningHours":false},{"Date":"16/03","OpenString":"08:00-21:00","Day":"Lørdag","Closed":false,"SpecialOpeningHours":false},{"Date":"17/03","OpenString":"Stengt","Day":"Søndag","Closed":true,"SpecialOpeningHours":false}],"AdditionalInformation":{"Html":null}}],"InfoMessage":""}

      return (
        stores: <Store>[],
        error: null,
      );
    } catch (e) {
      _logger.error('fetchForInput, $e');

      if (e is TimeoutException) {
        return (
          stores: null,
          error: const HttpTimeoutError(),
        );
      }

      return (
        stores: null,
        error: const HttpUnknownError(),
      );
    }
  }

  Future<StoreFetchResult> fetchForLoc({
    required double lat,
    required double lon,
  }) async {
    return (
      stores: null,
      error: const HttpNoInternetError(),
    );
  }

  // endregion

  // region NotExposed

  Uri _getUrlForInput(String input) {
    return Uri.parse('https://minside.coop.no/StoreService/SearchStores?searchInput=$input');
  }

  // endregion
}
